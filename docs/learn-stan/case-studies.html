<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Stan Case Studies – Stan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../img/logo_tm.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../theming/quarto_styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../img/logo_tm.png" alt="Stan logo" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Stan</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../install/"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mc-stan.org/docs"> 
<span class="menu-text">Documentation</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-learning-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Learning Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-learning-resources">    
        <li>
    <a class="dropdown-item" href="../learn-stan/tutorials.html">
 <span class="dropdown-text">Tutorials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../learn-stan/case-studies.html">
 <span class="dropdown-text">Case Studies</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../learn-stan/stancon-talks.html">
 <span class="dropdown-text">StanCon Talks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../learn-stan/field-guides.html">
 <span class="dropdown-text">Domain-specific</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../learn-stan/publications.html">
 <span class="dropdown-text">Publications</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../tools/"> 
<span class="menu-text">Tools</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about/"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/stan-dev" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://discourse.mc-stan.org" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-chat-text-fill"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#volume-10-2023" id="toc-volume-10-2023" class="nav-link active" data-scroll-target="#volume-10-2023">Volume 10 (2023)</a>
  <ul class="collapse">
  <li><a href="#instrumental-variables-analysis-of-randomized-experiments-with-one-sided-noncompliance" id="toc-instrumental-variables-analysis-of-randomized-experiments-with-one-sided-noncompliance" class="nav-link" data-scroll-target="#instrumental-variables-analysis-of-randomized-experiments-with-one-sided-noncompliance">Instrumental Variables Analysis of Randomized Experiments with One-Sided Noncompliance</a></li>
  <li><a href="#bayesian-structural-equation-modeling-using-blavaan" id="toc-bayesian-structural-equation-modeling-using-blavaan" class="nav-link" data-scroll-target="#bayesian-structural-equation-modeling-using-blavaan">Bayesian Structural Equation Modeling using blavaan</a></li>
  </ul></li>
  <li><a href="#volume-9-2022" id="toc-volume-9-2022" class="nav-link" data-scroll-target="#volume-9-2022">Volume 9 (2022)</a>
  <ul class="collapse">
  <li><a href="#multilevel-regression-modeling-with-cmdstanpy-and-plotnine" id="toc-multilevel-regression-modeling-with-cmdstanpy-and-plotnine" class="nav-link" data-scroll-target="#multilevel-regression-modeling-with-cmdstanpy-and-plotnine">Multilevel regression modeling with CmdStanPy and plotnine</a></li>
  <li><a href="#holoml-in-stan-low-photon-image-reconstruction" id="toc-holoml-in-stan-low-photon-image-reconstruction" class="nav-link" data-scroll-target="#holoml-in-stan-low-photon-image-reconstruction">HoloML in Stan: Low-photon Image Reconstruction</a></li>
  </ul></li>
  <li><a href="#volume-8-2021" id="toc-volume-8-2021" class="nav-link" data-scroll-target="#volume-8-2021">Volume 8 (2021)</a>
  <ul class="collapse">
  <li><a href="#bayesian-latent-class-models-and-handling-of-label-switching" id="toc-bayesian-latent-class-models-and-handling-of-label-switching" class="nav-link" data-scroll-target="#bayesian-latent-class-models-and-handling-of-label-switching">Bayesian Latent Class Models and Handling of Label Switching</a></li>
  </ul></li>
  <li><a href="#volume-7-2020" id="toc-volume-7-2020" class="nav-link" data-scroll-target="#volume-7-2020">Volume 7 (2020)</a>
  <ul class="collapse">
  <li><a href="#bayesian-model-of-planetary-motion-exploring-ideas-for-a-modeling-workflow-when-dealing-with-ordinary-differential-equations-and-multimodality" id="toc-bayesian-model-of-planetary-motion-exploring-ideas-for-a-modeling-workflow-when-dealing-with-ordinary-differential-equations-and-multimodality" class="nav-link" data-scroll-target="#bayesian-model-of-planetary-motion-exploring-ideas-for-a-modeling-workflow-when-dealing-with-ordinary-differential-equations-and-multimodality">Bayesian model of planetary motion: exploring ideas for a modeling workflow when dealing with ordinary differential equations and multimodality</a></li>
  <li><a href="#hmm-interface-example" id="toc-hmm-interface-example" class="nav-link" data-scroll-target="#hmm-interface-example">HMM Interface Example</a></li>
  <li><a href="#spatial-models-for-plant-neighborhood-dynamics-in-stan" id="toc-spatial-models-for-plant-neighborhood-dynamics-in-stan" class="nav-link" data-scroll-target="#spatial-models-for-plant-neighborhood-dynamics-in-stan">Spatial models for plant neighborhood dynamics in Stan</a></li>
  <li><a href="#upgrading-to-the-new-ode-interface" id="toc-upgrading-to-the-new-ode-interface" class="nav-link" data-scroll-target="#upgrading-to-the-new-ode-interface">Upgrading to the new ODE interface</a></li>
  <li><a href="#bayesian-workflow-for-disease-transmission-modeling-in-stan" id="toc-bayesian-workflow-for-disease-transmission-modeling-in-stan" class="nav-link" data-scroll-target="#bayesian-workflow-for-disease-transmission-modeling-in-stan">Bayesian Workflow for disease transmission modeling in Stan</a></li>
  <li><a href="#reduce-sum-example-parallelization-of-a-single-chain-across-multiple-cores" id="toc-reduce-sum-example-parallelization-of-a-single-chain-across-multiple-cores" class="nav-link" data-scroll-target="#reduce-sum-example-parallelization-of-a-single-chain-across-multiple-cores">Reduce Sum Example: parallelization of a single chain across multiple cores</a></li>
  <li><a href="#stan-notebooks-in-the-cloud" id="toc-stan-notebooks-in-the-cloud" class="nav-link" data-scroll-target="#stan-notebooks-in-the-cloud">Stan Notebooks in the Cloud</a></li>
  </ul></li>
  <li><a href="#volume-6-2019" id="toc-volume-6-2019" class="nav-link" data-scroll-target="#volume-6-2019">Volume 6 (2019)</a>
  <ul class="collapse">
  <li><a href="#model-based-inference-for-causal-effects-in-completely-randomized-experiments" id="toc-model-based-inference-for-causal-effects-in-completely-randomized-experiments" class="nav-link" data-scroll-target="#model-based-inference-for-causal-effects-in-completely-randomized-experiments">Model-based Inference for Causal Effects in Completely Randomized Experiments</a></li>
  <li><a href="#tagging-basketball-events-with-hmm-in-stan" id="toc-tagging-basketball-events-with-hmm-in-stan" class="nav-link" data-scroll-target="#tagging-basketball-events-with-hmm-in-stan">Tagging Basketball Events with HMM in Stan</a></li>
  <li><a href="#model-building-and-expansion-for-golf-putting" id="toc-model-building-and-expansion-for-golf-putting" class="nav-link" data-scroll-target="#model-building-and-expansion-for-golf-putting">Model building and expansion for golf putting</a></li>
  <li><a href="#a-dyadic-item-response-theory-model-stan-case-study" id="toc-a-dyadic-item-response-theory-model-stan-case-study" class="nav-link" data-scroll-target="#a-dyadic-item-response-theory-model-stan-case-study">A Dyadic Item Response Theory Model: Stan Case Study</a></li>
  </ul></li>
  <li><a href="#volume-5-2018" id="toc-volume-5-2018" class="nav-link" data-scroll-target="#volume-5-2018">Volume 5 (2018)</a>
  <ul class="collapse">
  <li><a href="#multilevel-linear-models-using-rstanarm" id="toc-multilevel-linear-models-using-rstanarm" class="nav-link" data-scroll-target="#multilevel-linear-models-using-rstanarm">Multilevel Linear Models using Rstanarm</a></li>
  <li><a href="#predator-prey-population-dynamics-the-lotka-volterra-model-in-stan" id="toc-predator-prey-population-dynamics-the-lotka-volterra-model-in-stan" class="nav-link" data-scroll-target="#predator-prey-population-dynamics-the-lotka-volterra-model-in-stan">Predator-Prey Population Dynamics: the Lotka-Volterra model in Stan</a></li>
  <li><a href="#nearest-neighbor-gaussian-process-nngp-models-in-stan" id="toc-nearest-neighbor-gaussian-process-nngp-models-in-stan" class="nav-link" data-scroll-target="#nearest-neighbor-gaussian-process-nngp-models-in-stan">Nearest neighbor Gaussian process (NNGP) models in Stan</a></li>
  </ul></li>
  <li><a href="#volume-4-2017" id="toc-volume-4-2017" class="nav-link" data-scroll-target="#volume-4-2017">Volume 4 (2017)</a>
  <ul class="collapse">
  <li><a href="#extreme-value-analysis-and-user-defined-probability-functions-in-stan" id="toc-extreme-value-analysis-and-user-defined-probability-functions-in-stan" class="nav-link" data-scroll-target="#extreme-value-analysis-and-user-defined-probability-functions-in-stan">Extreme value analysis and user defined probability functions in Stan</a></li>
  <li><a href="#modelling-loss-curves-in-insurance-with-rstan" id="toc-modelling-loss-curves-in-insurance-with-rstan" class="nav-link" data-scroll-target="#modelling-loss-curves-in-insurance-with-rstan">Modelling Loss Curves in Insurance with RStan</a></li>
  <li><a href="#splines-in-stan" id="toc-splines-in-stan" class="nav-link" data-scroll-target="#splines-in-stan">Splines in Stan</a></li>
  <li><a href="#spatial-models-in-stan-intrinsic-auto-regressive-models-for-areal-data" id="toc-spatial-models-in-stan-intrinsic-auto-regressive-models-for-areal-data" class="nav-link" data-scroll-target="#spatial-models-in-stan-intrinsic-auto-regressive-models-for-areal-data">Spatial Models in Stan: Intrinsic Auto-Regressive Models for Areal Data</a></li>
  <li><a href="#the-qr-decomposition-for-regression-models" id="toc-the-qr-decomposition-for-regression-models" class="nav-link" data-scroll-target="#the-qr-decomposition-for-regression-models">The QR Decomposition for Regression Models</a></li>
  <li><a href="#robust-rstan-workflow" id="toc-robust-rstan-workflow" class="nav-link" data-scroll-target="#robust-rstan-workflow">Robust RStan Workflow</a></li>
  <li><a href="#robust-pystan-workflow" id="toc-robust-pystan-workflow" class="nav-link" data-scroll-target="#robust-pystan-workflow">Robust PyStan Workflow</a></li>
  <li><a href="#typical-sets-and-the-curse-of-dimensionality" id="toc-typical-sets-and-the-curse-of-dimensionality" class="nav-link" data-scroll-target="#typical-sets-and-the-curse-of-dimensionality">Typical Sets and the Curse of Dimensionality</a></li>
  <li><a href="#diagnosing-biased-inference-with-divergences" id="toc-diagnosing-biased-inference-with-divergences" class="nav-link" data-scroll-target="#diagnosing-biased-inference-with-divergences">Diagnosing Biased Inference with Divergences</a></li>
  <li><a href="#identifying-bayesian-mixture-models" id="toc-identifying-bayesian-mixture-models" class="nav-link" data-scroll-target="#identifying-bayesian-mixture-models">Identifying Bayesian Mixture Models</a></li>
  <li><a href="#how-the-shape-of-a-weakly-informative-prior-affects-inferences" id="toc-how-the-shape-of-a-weakly-informative-prior-affects-inferences" class="nav-link" data-scroll-target="#how-the-shape-of-a-weakly-informative-prior-affects-inferences">How the Shape of a Weakly Informative Prior Affects Inferences</a></li>
  </ul></li>
  <li><a href="#volume-3-2016" id="toc-volume-3-2016" class="nav-link" data-scroll-target="#volume-3-2016">Volume 3 (2016)</a>
  <ul class="collapse">
  <li><a href="#exact-sparse-car-models-in-stan" id="toc-exact-sparse-car-models-in-stan" class="nav-link" data-scroll-target="#exact-sparse-car-models-in-stan">Exact Sparse CAR Models in Stan</a></li>
  <li><a href="#a-primer-on-bayesian-multilevel-modeling-using-pystan" id="toc-a-primer-on-bayesian-multilevel-modeling-using-pystan" class="nav-link" data-scroll-target="#a-primer-on-bayesian-multilevel-modeling-using-pystan">A Primer on Bayesian Multilevel Modeling using PyStan</a></li>
  <li><a href="#the-impact-of-reparameterization-on-point-estimates" id="toc-the-impact-of-reparameterization-on-point-estimates" class="nav-link" data-scroll-target="#the-impact-of-reparameterization-on-point-estimates">The Impact of Reparameterization on Point Estimates</a></li>
  <li><a href="#hierarchical-two-parameter-logistic-item-response-model" id="toc-hierarchical-two-parameter-logistic-item-response-model" class="nav-link" data-scroll-target="#hierarchical-two-parameter-logistic-item-response-model">Hierarchical Two-Parameter Logistic Item Response Model</a></li>
  <li><a href="#rating-scale-and-generalized-rating-scale-models-with-latent-regression" id="toc-rating-scale-and-generalized-rating-scale-models-with-latent-regression" class="nav-link" data-scroll-target="#rating-scale-and-generalized-rating-scale-models-with-latent-regression">Rating Scale and Generalized Rating Scale Models with Latent Regression</a></li>
  <li><a href="#partial-credit-and-generalized-partial-credit-models-with-latent-regression" id="toc-partial-credit-and-generalized-partial-credit-models-with-latent-regression" class="nav-link" data-scroll-target="#partial-credit-and-generalized-partial-credit-models-with-latent-regression">Partial Credit and Generalized Partial Credit Models with Latent Regression</a></li>
  <li><a href="#rasch-and-two-parameter-logistic-item-response-models-with-latent-regression" id="toc-rasch-and-two-parameter-logistic-item-response-models-with-latent-regression" class="nav-link" data-scroll-target="#rasch-and-two-parameter-logistic-item-response-models-with-latent-regression">Rasch and Two-Parameter Logistic Item Response Models with Latent Regression</a></li>
  <li><a href="#two-parameter-logistic-item-response-model" id="toc-two-parameter-logistic-item-response-model" class="nav-link" data-scroll-target="#two-parameter-logistic-item-response-model">Two-Parameter Logistic Item Response Model</a></li>
  <li><a href="#cognitive-diagnosis-model-dina-model-with-independent-attributes" id="toc-cognitive-diagnosis-model-dina-model-with-independent-attributes" class="nav-link" data-scroll-target="#cognitive-diagnosis-model-dina-model-with-independent-attributes">Cognitive Diagnosis Model: DINA model with independent attributes</a></li>
  <li><a href="#pooling-with-hierarchical-models-for-repeated-binary-trials" id="toc-pooling-with-hierarchical-models-for-repeated-binary-trials" class="nav-link" data-scroll-target="#pooling-with-hierarchical-models-for-repeated-binary-trials">Pooling with Hierarchical Models for Repeated Binary Trials</a></li>
  </ul></li>
  <li><a href="#volume-2-2015" id="toc-volume-2-2015" class="nav-link" data-scroll-target="#volume-2-2015">Volume 2 (2015)</a>
  <ul class="collapse">
  <li><a href="#multiple-species-site-occupancy-model" id="toc-multiple-species-site-occupancy-model" class="nav-link" data-scroll-target="#multiple-species-site-occupancy-model">Multiple Species-Site Occupancy Model</a></li>
  </ul></li>
  <li><a href="#volume-1-2014" id="toc-volume-1-2014" class="nav-link" data-scroll-target="#volume-1-2014">Volume 1 (2014)</a>
  <ul class="collapse">
  <li><a href="#soil-carbon-modeling-with-rstan" id="toc-soil-carbon-modeling-with-rstan" class="nav-link" data-scroll-target="#soil-carbon-modeling-with-rstan">Soil Carbon Modeling with RStan</a></li>
  </ul></li>
  <li><a href="#contributing-case-studies" id="toc-contributing-case-studies" class="nav-link" data-scroll-target="#contributing-case-studies">Contributing Case Studies</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Stan Case Studies</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<p>The case studies on this page are intended to reflect best practices in Bayesian methodology and Stan programming. We aim to keep them current with the latest version of the Stan language, but there may be times when case studies need updating to reflect the latest Stan features and syntax.</p>
<section id="volume-10-2023" class="level2">
<h2 class="anchored" data-anchor-id="volume-10-2023">Volume 10 (2023)</h2>
<section id="instrumental-variables-analysis-of-randomized-experiments-with-one-sided-noncompliance" class="level3">
<h3 class="anchored" data-anchor-id="instrumental-variables-analysis-of-randomized-experiments-with-one-sided-noncompliance">Instrumental Variables Analysis of Randomized Experiments with One-Sided Noncompliance</h3>
<p>In this document, we demonstrate how to implement Bayesian inference for causal effects in randomized experiments with one-sided noncompliance using Stan. Specifically, we aim to replicate the analysis presented in Imbens and Rubin (1997). We present Stan models with and without the exclusion restriction assumption, showcasing a significant advantage of the Bayesian model-based approach.</p>
<p><a href="case-studies/cace_one-sided.html" target="_blank" rel="noopener noreferrer">View HTML</a> <em>(link opens in new tab)</em></p>
<dl>
<dt>Authors</dt>
<dd>
JoonHo Lee, Avi Feller, Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
causal inference, instrumental variables analysis, one-sided compliance, principal stratification
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/joonho112/example-models/tree/master/education/causal_iv_one-sided" target="_blank">example-models/education/causal_iv_one-sided</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>tidyverse</code>, <code>rstan</code>, <code>bayesplot</code>, <code>patchwork</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="bayesian-structural-equation-modeling-using-blavaan" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-structural-equation-modeling-using-blavaan">Bayesian Structural Equation Modeling using blavaan</h3>
<p>In this case study, we fit Bayesian structural equation models (SEM) using Hamiltonian Monte Carlo sampling in Stan-powered R package <em>blavaan</em> and illustrate how to use confirmtory factor analysis and latent growth curve modeling as SEM’s special cases. We also compared the estimates from <em>blavaan</em> with its frequentist counterpart using <em>lavaan</em>.</p>
<p><a href="case-studies/sem.html" title="SEM blavaan" target="_blank" rel="noopener noreferrer">View HTML</a> (<em>Link opens in new tab</em>)</p>
<dl>
<dt>Authors</dt>
<dd>
Feng Ji, Xingyao Xiao, Aybolek Amanmyradova, Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
Structural Equation Modeling (SEM), Lavant Variable Modeling, Latent Growth Curve Models, Confirmatory Factor Analysis (CFA), Growth Curve Modeling, Bayesian Model Evaluation
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/education-stan/example-models/tree/master/education/sem" target="_blank">example-models/education/sem</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>blavaan, lavaan, rstan, MASS, mvtnorm, tidyverse, semPlot, magrittr, lavaan.survey</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
</section>
<section id="volume-9-2022" class="level2">
<h2 class="anchored" data-anchor-id="volume-9-2022">Volume 9 (2022)</h2>
<section id="multilevel-regression-modeling-with-cmdstanpy-and-plotnine" class="level3">
<h3 class="anchored" data-anchor-id="multilevel-regression-modeling-with-cmdstanpy-and-plotnine">Multilevel regression modeling with CmdStanPy and plotnine</h3>
<p>This notebook is a short introduction to multilevel regression modeling using the <a href="https://mc-stan.org/cmdstanpy/" target="_blank">CmdStanPy</a>interface and <a href="https://plotnine.readthedocs.io/en/stable/">plotnine</a>, a Python implementation of a <a href="https://vita.had.co.nz/papers/layered-grammar.pdf" target="_blank"><em>grammar of graphics</em></a> based on <a href="https://en.wikipedia.org/wiki/Ggplot2" target="_blank">ggplot2</a>.</p>
<p><a href="case-studies/radon_cmdstanpy_plotnine.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Mitzi Morris
</dd>
<dt>Keywords</dt>
<dd>
Python, CmdStanPy, plotnine, hierarchical/multilevel modeling, linear regression, posterior predictive checks, radon
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/jupyter/radon" target="_blank">example-models/jupyter/radon</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>cmdstanpy</code>, <code>numpy</code>, <code>pandas</code>, <code>matplotlib</code>, <code>plotnine</code>, <code>jupyter</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="holoml-in-stan-low-photon-image-reconstruction" class="level3">
<h3 class="anchored" data-anchor-id="holoml-in-stan-low-photon-image-reconstruction">HoloML in Stan: Low-photon Image Reconstruction</h3>
<p>In this case study, we perform image reconstruction in Stan by implementing the HoloML phase retrieval model and then solving the inverse problem with optimization. This case study requires Stan 2.30 or greater in order to use the Fourier transform functions added in that version.</p>
<p><a href="case-studies/HoloML_in_Stan.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Brian Ward, Bob Carpenter, and David Barmherzig
</dd>
<dt>Keywords</dt>
<dd>
image reconstruction, phase retrieval, Fourier transforms, deconvolution
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/WardBrian/holoml-in-stan" target="_blank">WardBrian/holoml-in-stan</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>cmdstanpy</code>, <code>numpy</code>, <code>matplotlib</code>, <code>scipy</code>, <code>jupyter</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
</section>
<section id="volume-8-2021" class="level2">
<h2 class="anchored" data-anchor-id="volume-8-2021">Volume 8 (2021)</h2>
<section id="bayesian-latent-class-models-and-handling-of-label-switching" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-latent-class-models-and-handling-of-label-switching">Bayesian Latent Class Models and Handling of Label Switching</h3>
<p>In this case study, we fit the Bayesian latent class model using Hamiltonian Monte Carlo sampling and Variational Bayes in Stan and illustrate the issue of label switching and its treatment with simulated and empirical data.</p>
<p><a href="case-studies/Latent_class_case_study.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Feng Ji, Aybolek Amanmyradova, Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
latent class models, label-switching, post-hoc relabeling, variational Bayes
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/education-stan/example-models/tree/master/education/latent_class" target="_blank">example-models/education/latent_class</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>label.switching</code>, <code>rstan</code>, <code>magrittr</code>, <code>knitr</code>, <code>poLCA</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
</section>
<section id="volume-7-2020" class="level2">
<h2 class="anchored" data-anchor-id="volume-7-2020">Volume 7 (2020)</h2>
<section id="bayesian-model-of-planetary-motion-exploring-ideas-for-a-modeling-workflow-when-dealing-with-ordinary-differential-equations-and-multimodality" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-model-of-planetary-motion-exploring-ideas-for-a-modeling-workflow-when-dealing-with-ordinary-differential-equations-and-multimodality">Bayesian model of planetary motion: exploring ideas for a modeling workflow when dealing with ordinary differential equations and multimodality</h3>
<p>The Bayesian model of planetary motion is a simple but powerful example that illustrates important concepts, as well as gaps, in prescribed modeling workflows. Our focus is on Bayesian inference using Markov chains Monte Carlo for a model based on an ordinary differential equations (ODE). Our example presents unexpected multimodality, causing our inference to be unreliable and what is more, dramatically slowing down our ODE integrators. What do we do when our chains do not mix and do not forget their starting points? Reasoning about the computational statistics at hand and the physics of the modeled phenomenon, we diagnose how the modes arise and how to improve our inference. Our process for fitting the model is iterative, starting with a simplification and building the model back up, and makes extensive use of visualization.</p>
<p><a href="case-studies/planetary_motion.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Charles Margossian and Andrew Gelman
</dd>
<dt>Keywords</dt>
<dd>
ordinary differential equations, multimodality, classical mechanics
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/planetary_motion" target="_blank">example-models/knitr/planetary_motion</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>CmdStanR</code>, <code>posterior</code>, <code>ggplot2</code>, <code>dplyr</code>, <code>plyr</code>, <code>tidyr</code>, <code>boot</code>, <code>latex2exp</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="hmm-interface-example" class="level3">
<h3 class="anchored" data-anchor-id="hmm-interface-example">HMM Interface Example</h3>
<p>Cmdstan 2.24 introduces a new interface for working with Hidden Markov Models (HMMs). This is an example of how to use that interface.</p>
<p><a href="case-studies/hmm-example.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Ben Bales
</dd>
<dt>Keywords</dt>
<dd>
Hidden Markov Models, HMMs, cmdstanr, Stan programming
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/hmm-example" target="_blank">example-models/knitr/hmm-example</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>CmdStanR</code>, <code>tidyverse</code>, <code>ggplot2</code>, <code>posterior</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="spatial-models-for-plant-neighborhood-dynamics-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="spatial-models-for-plant-neighborhood-dynamics-in-stan">Spatial models for plant neighborhood dynamics in Stan</h3>
<p>In this case study, we demonstrate how Stan’s segment function can speed computation on sparse matrices of pairwise neighbors in plant-plant interaction models. In addition, we present solutions to common problems of fitting neighborhood models with hierarchical effects, including a comparison of centered vs.&nbsp;non-centered parameterizations.</p>
<p><a href="case-studies/plantInteractions.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Cristina Barber, Andrii Zaiats, Cara Applestein and T.Trevor Caughlin
</dd>
<dt>Keywords</dt>
<dd>
plants, neighbor interactions, sparse matrix, segment function
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/Cristinabarber/Neighbor_Interactions" target="_blank">Cristinabarber/Neighbor_Interactions</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC BY NC
</dd>
</dl>
</section>
<section id="upgrading-to-the-new-ode-interface" class="level3">
<h3 class="anchored" data-anchor-id="upgrading-to-the-new-ode-interface">Upgrading to the new ODE interface</h3>
<p>Cmdstan 2.24 introduces a new ODE interface intended to make it easier to specify the ODE system function. This document should serve as an overview of the interface changes as well as a tutorial for converting code written with the old ODE interface.</p>
<p><a href="case-studies/convert_odes.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Ben Bales, Sebastian Weber
</dd>
<dt>Keywords</dt>
<dd>
ordinary differential equations, cmdstanr, Stan programming
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/convert-odes" target="_blank">example-models/knitr/convert-odes</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>CmdStanR</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="bayesian-workflow-for-disease-transmission-modeling-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-workflow-for-disease-transmission-modeling-in-stan">Bayesian Workflow for disease transmission modeling in Stan</h3>
<p>This tutorial shows how to build, fit, and criticize disease transmission models in Stan, and should be useful to researchers interested in modeling the COVID-19 outbreak and doing Bayesian inference. Bayesian modeling provides a principled way to quantify uncertainty and incorporate prior knowledge into the model. What is more, Stan’s main inference engine, Hamiltonian Monte Carlo sampling, is amiable to diagnostics, which means we can verify whether our inference is reliable. Stan is an expressive probabilistic programing language that abstracts the inference and allows users to focus on the modeling. The resulting code is readable and easily extensible, which makes the modeler’s work more transparent and flexible. In this tutorial, we demonstrate with a simple Susceptible-Infected-Recovered (SIR) model how to formulate, fit, and diagnose a compartmental model in Stan. We also introduce more advanced topics which can help practitioners fit sophisticated models; notably, how to use simulations to probe our model and our priors, and computational techniques to scale ODE-based models.</p>
<p><a href="case-studies/boarding_school_case_study.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Leo Grinsztajn, Elizaveta Semenova, Charles C. Margossian, and Julien Riou
</dd>
<dt>Keywords</dt>
<dd>
Disease transmission, Compartment models, Ordinary Differential Equations, Bayesian Workflow
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/charlesm93/disease_transmission_workflow" target="_blank">charlesm93/disease_transmission_workflow</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>RStan</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="reduce-sum-example-parallelization-of-a-single-chain-across-multiple-cores" class="level3">
<h3 class="anchored" data-anchor-id="reduce-sum-example-parallelization-of-a-single-chain-across-multiple-cores">Reduce Sum Example: parallelization of a single chain across multiple cores</h3>
<p>Stan 2.23 introduced <code>reduce_sum</code>, a new way to parallelize the execution of a single Stan chain across multiple cores. This introduction copies directly from Richard McElreath’s <a href="https://github.com/rmcelreath/cmdstan_map_rect_tutorial" target="_blank">Multithreading and Map-Reduce in Stan 2.18.0: A Minimal Example</a></p>
<p><a href="case-studies/reduce_sum_tutorial.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Ben Bales
</dd>
<dt>Keywords</dt>
<dd>
within-chain parallel computation, cmdstanr, Stan programming
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/reduce-sum" target="_blank">example-models/knitr/reduce-sum</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
<code>CmdStanR</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="stan-notebooks-in-the-cloud" class="level3">
<h3 class="anchored" data-anchor-id="stan-notebooks-in-the-cloud">Stan Notebooks in the Cloud</h3>
<p>This report shows you how to author a Jupyter Notebook for your Stan model and data so that anyone with a modern web browser and a Google account can run your analysis with Google Colaboratory free cloud servers. It shows you how to quickly set up a Stan installation in the cloud and introduces two lightweight interfaces: <a href="https://mc-stan.org/cmdstanr/" target="_blank">CmdStanR</a> and <a href="https://cmdstanpy.readthedocs.io/" target="_blank">CmdStanPy</a>.</p>
<p><a href="case-studies/jupyter_colab_notebooks_2020.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Mitzi Morris
</dd>
<dt>Keywords</dt>
<dd>
Jupyter, Google Colab, teaching Stan, online classroom, cloud computing
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/cloud-compute-2020" target="_blank">example-models/knitr/cloud-compute-2020</a> (GitHub)
</dd>
<dt>Dependencies</dt>
<dd>
internet connection, Google account
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
</section>
<section id="volume-6-2019" class="level2">
<h2 class="anchored" data-anchor-id="volume-6-2019">Volume 6 (2019)</h2>
<section id="model-based-inference-for-causal-effects-in-completely-randomized-experiments" class="level3">
<h3 class="anchored" data-anchor-id="model-based-inference-for-causal-effects-in-completely-randomized-experiments">Model-based Inference for Causal Effects in Completely Randomized Experiments</h3>
<p>In this document, we discuss the implementation of Bayesian model-based inference for causal effects in Stan. We start by providing an introduction to the Bayesian inferential framework by analyzing a simulated dataset generated under unconfounded treatment assignment. Then we analyze an example dataset obtained from a completely randomized experiment focusing on the specification of the joint distribution of the potential outcomes.</p>
<p><a href="case-studies/model-based_causal_inference_for_RCT.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
JoonHo Lee, Avi Feller and Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
causal inference, completely randomized experiments
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/causal_rct" target="_blank">example-models/education/causal_rct</a>
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>rstanarm</code>, <code>bayesplot</code>, <code>tidyverse</code>, <code>gridExtra</code>, <code>Matching</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="tagging-basketball-events-with-hmm-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="tagging-basketball-events-with-hmm-in-stan">Tagging Basketball Events with HMM in Stan</h3>
<p>This case study shows how we can apply Bayesian inference to Hidden Markov Models (HMMs) using Stan to extract useful information from basketball player tracking data. Specifically we show how to tag drive events and how to determine defensive assignment. Before diving into basketball data we show how to fit an HMM in Stan using a simple example. This should help build some intuition for those who are unfamiliar with HMMs and will also show how to specify an HMM using Stan.</p>
<p><a href="case-studies/bball-hmm.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Imad Ali
</dd>
<dt>Keywords</dt>
<dd>
hidden markov models, sports
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/imadmali/bball-hmm" target="_blank">imadmali/bball-hmm</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>bayesplot</code>, <code>dplyr</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY-NC
</dd>
</dl>
</section>
<section id="model-building-and-expansion-for-golf-putting" class="level3">
<h3 class="anchored" data-anchor-id="model-building-and-expansion-for-golf-putting">Model building and expansion for golf putting</h3>
<p>In this case study, we use Stan to build a series of models to estimate the probability of a successful putt using data from professional golfers. We fit and check the fit of a series of models, demonstrating the benefits of modeling based on substantive (rather than purely statistical) principles. We successfully fit to a small dataset and then have to expand the model to fit a new, larger dataset. We use weakly informative priors and a model-misfit error term to enable the fit.</p>
<p><a href="case-studies/golf.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Andrew Gelman
</dd>
<dt>Keywords</dt>
<dd>
nonlinear regression, sports
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/golf" target="_blank">example-models/knitr/golf</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="a-dyadic-item-response-theory-model-stan-case-study" class="level3">
<h3 class="anchored" data-anchor-id="a-dyadic-item-response-theory-model-stan-case-study">A Dyadic Item Response Theory Model: Stan Case Study</h3>
<p>In this case study, we use Stan to fit the Dyadic Item Response Theory (dIRT) model proposed by (Gin et al.&nbsp;2019) to measure interactions between pairs of individuals when the responses to items represent the actions/behaviors/perceptions of an individual (called the ‘actor’) made within the context of a dyad formed with another individual (called the ‘partner’). The dIRT model is fit using Stan (version 2.18.1) in R via the rstan package.</p>
<p><a href="case-studies/dyadic_irt_model.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Nicholas Sim, Brian Gin, Anders Skrondal and Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
item response theory, social relations model, dyadic data
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/education-stan/example-models/tree/master/education/dyadic_irt_model" target="_blank">example-models/education/dyadic_irt_model</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>tidyverse</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
</section>
<section id="volume-5-2018" class="level2">
<h2 class="anchored" data-anchor-id="volume-5-2018">Volume 5 (2018)</h2>
<section id="multilevel-linear-models-using-rstanarm" class="level3">
<h3 class="anchored" data-anchor-id="multilevel-linear-models-using-rstanarm">Multilevel Linear Models using Rstanarm</h3>
<p>In this tutorial, we illustrate how to fit a multilevel linear model within a full Bayesian framework using rstanarm. This tutorial is aimed primarily at educational researchers who have used lme4 in R to fit models to their data and who may be interested in learning how to fit Bayesian multilevel models. However, for readers who have not used lme4 before, we briefly review the use of the package for fitting multilevel models.</p>
<p><a href="case-studies/tutorial_rstanarm.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
JoonHo Lee, Nicholas Sim, Feng Ji, and Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
education, rstanarm, multilevel models, linear mixed models, hierarchical linear models
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/tutorial_rstanarm" target="_blank">example-models/education/tutorial_rstanarm</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstanarm</code>, <code>mlmRev</code>, <code>ggplot2</code>, <code>lme4</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="predator-prey-population-dynamics-the-lotka-volterra-model-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="predator-prey-population-dynamics-the-lotka-volterra-model-in-stan">Predator-Prey Population Dynamics: the Lotka-Volterra model in Stan</h3>
<p>Lotka (1925) and Volterra (1926) formulated parametric differential equations that characterize the oscillating populations of predators and prey. A statistical model to account for measurement error and unexplained variation uses the deterministic solutions to the Lotka-Volterra equations as expected population sizes. Stan is used to encode the statistical model and perform full Bayesian inference to solve the inverse problem of inferring parameters from noisy data. The model is fit to Canadian lynx and snowshoe hare populations between 1900 and 1920, based on the number of pelts collected annually by the Hudson’s Bay Company. Posterior predictive checks for replicated data show the model fits this data well. Full Bayesian inference may be used to estimate future (or past) populations.</p>
<p><a href="case-studies/lotka-volterra-predator-prey.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Bob Carpenter
</dd>
<dt>Keywords</dt>
<dd>
population dynamics, Lotka-Volterra equations, differential equations, posterior predictive checks
</dd>
<dt>Source Repository</dt>
<dd>
<a href="" target="_blank">stan-dev/example-models/knitr/lotka-volterra</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>&gt;ggplot2</code>, <code>gridExtra</code>, <code>knitr</code>, <code>reshape</code>, <code>tufte</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="nearest-neighbor-gaussian-process-nngp-models-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="nearest-neighbor-gaussian-process-nngp-models-in-stan">Nearest neighbor Gaussian process (NNGP) models in Stan</h3>
<p>Nearest neighbor Gaussian process (NNGP) based models is a family of highly scalable Gaussian processes based models. In brief, NNGP extends the Vecchia’s approximation (Vecchia 1988) to a process using conditional independence given information from neighboring locations. This case study shows how to express and fit these models in Stan.</p>
<p><a href="case-studies/nngp.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Lu Zhang
</dd>
<dt>Keywords</dt>
<dd>
Gaussian process, nearest neighbor Gaussian process, spatial models, latent process, regression
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/LuZhangstat/NNGP_STAN" target="_blank">LuZhangstat/NNGP_STAN</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
</section>
<section id="volume-4-2017" class="level2">
<h2 class="anchored" data-anchor-id="volume-4-2017">Volume 4 (2017)</h2>
<section id="extreme-value-analysis-and-user-defined-probability-functions-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="extreme-value-analysis-and-user-defined-probability-functions-in-stan">Extreme value analysis and user defined probability functions in Stan</h3>
<p>This notebook demonstrates how to implement user defined probability functions in Stan language. As an example I use the generalized Pareto distribution (GPD) to model geomagnetic storm data from the World Data Center for Geomagnetism.</p>
<p><a href="case-studies/gpareto_functions.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Aki Vehtari
</dd>
<dt>Keywords</dt>
<dd>
extreme value analysis, generalized Pareto distribution, user defined probability functions
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/avehtari/BDA_R_demos/tree/master/demos_rstan/gpareto_functions" target="_blank">avehtari/BDA_R_demos/demos_rstan/gpareto_functions</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>bayesplot</code>, <code>loo</code>, <code>ggplot2</code>, <code>tidyr</code>, <code>dplyr</code>, <code>extraDistr</code>, <code>gridExtra</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="modelling-loss-curves-in-insurance-with-rstan" class="level3">
<h3 class="anchored" data-anchor-id="modelling-loss-curves-in-insurance-with-rstan">Modelling Loss Curves in Insurance with RStan</h3>
<p>Loss curves are a standard actuarial technique for helping insurance companies assess the amount of reserve capital they need to keep on hand to cover claims from a line of business. Claims made and reported for a given accounting period are tracked separately over time. This enables the use of historical patterns of claim development to predict expected total claims for newer policies.</p>
<p>We model the growth of the losses in each accounting period as an increasing function of time, and use the model to estimate the parameters which determine the shape and form of this growth. We also use the sampler to estimate the values of the “ultimate loss ratio”, i.e.&nbsp;the ratio of the total claims on an accounting period to the total premium received to write those policies. We treat each accounting period as a cohort.</p>
<p><a href="case-studies/losscurves_casestudy.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Mick Cooney
</dd>
<dt>Keywords</dt>
<dd>
actuarial science, loss curves, insurance, ultimate loss ratio, hierarchical model
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/kaybenleroll/stancasestudy_losscurves" target="_blank">kaybenleroll/stancasestudy_losscurves</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>bayesplot</code>, <code>tidyverse</code>, <code>scales</code>, <code>cowplot</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="splines-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="splines-in-stan">Splines in Stan</h3>
<p>In this document, we discuss the implementation of splines in Stan. We start by providing a brief introduction to splines and then explain how they can be implemented in Stan. We also discuss a novel prior that alleviates some of the practical challenges of spline models.</p>
<p><a href="case-studies/splines_in_stan.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Milad Kharratzadeh
</dd>
<dt>Keywords</dt>
<dd>
B-splines, piecewise regression, knots, priors
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/milkha/Splines_in_Stan" target="_blank">milkha/Splines_in_Stan</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>splines</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="spatial-models-in-stan-intrinsic-auto-regressive-models-for-areal-data" class="level3">
<h3 class="anchored" data-anchor-id="spatial-models-in-stan-intrinsic-auto-regressive-models-for-areal-data">Spatial Models in Stan: Intrinsic Auto-Regressive Models for Areal Data</h3>
<p>This case study shows how to efficiently encode and compute an Intrinsic Conditional Auto-Regressive (ICAR) model in Stan. When data has a neighborhood structure, ICAR models provide spatial smoothing by averaging measurements of directly adjoining regions. The Besag, York, and Mollié (BYM) model is a Poisson GLM which includes both an ICAR component and an ordinary random-effects component for non-spatial heterogeneity. We compare two variants of the BYM model and fit two datasets taken from epidemiological studies over 56 and 700 regions, respectively.</p>
<p><a href="case-studies/icar_stan.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Mitzi Morris
</dd>
<dt>Keywords</dt>
<dd>
spatial modeling, CAR, ICAR, INLA, OpenBUGS, hierarchical models
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/car-iar-poisson" target="_blank">stan-dev/example-models</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>cmdstanr</code>, <code>ggplot2</code>, <code>broom</code>, <code>reshape2</code>, <code>dplyr</code>, <code>maptools</code>, <code>spdep</code>, <code>R-INLA</code>, <code>R2OpenBugs</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="the-qr-decomposition-for-regression-models" class="level3">
<h3 class="anchored" data-anchor-id="the-qr-decomposition-for-regression-models">The QR Decomposition for Regression Models</h3>
<p>This case study reviews the QR decomposition, a technique for decorrelating covariates and, consequently, the resulting posterior distribution in regression models.</p>
<p><a href="case-studies/qr_regression.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Michael Betancourt
</dd>
<dt>Keywords</dt>
<dd>
Markov chain Monte Carlo, regression, RStan
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/betanalpha/knitr_case_studies/tree/master/qr_regression" target="_blank">betanalpha/knitr_case_studies/qr_regression</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>knitr</code>.
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="robust-rstan-workflow" class="level3">
<h3 class="anchored" data-anchor-id="robust-rstan-workflow">Robust RStan Workflow</h3>
<p>This case study demonstrates the recommended RStan workflow for ensuring robust inferences with the default dynamic Hamiltonian Monte Carlo algorithm.</p>
<p><a href="case-studies/rstan_workflow.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Michael Betancourt
</dd>
<dt>Keywords</dt>
<dd>
Markov chain Monte Carlo, Hamiltonian Monte Carlo, divergences, RStan
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/betanalpha/knitr_case_studies/tree/master/rstan_workflow" target="_blank">betanalpha/knitr_case_studies/rstan_workflow</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>knitr</code>.
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="robust-pystan-workflow" class="level3">
<h3 class="anchored" data-anchor-id="robust-pystan-workflow">Robust PyStan Workflow</h3>
<p>This case study demonstrates the recommended PyStan workflow for ensuring robust inferences with the default dynamic Hamiltonian Monte Carlo algorithm.</p>
<p><a href="case-studies/pystan_workflow.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Michael Betancourt
</dd>
<dt>Keywords</dt>
<dd>
Markov chain Monte Carlo, Hamiltonian Monte Carlo, divergences, PyStan
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/betanalpha/jupyter_case_studies/tree/master/pystan_workflow" target="_blank">betanalpha/jupyter_case_studies/pystan_workflow</a> (GitHub)
</dd>
<dt>Python Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>pystan, pickle, numpy, md5</code>.
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="typical-sets-and-the-curse-of-dimensionality" class="level3">
<h3 class="anchored" data-anchor-id="typical-sets-and-the-curse-of-dimensionality">Typical Sets and the Curse of Dimensionality</h3>
<p>This case study illustrates the so-called “curse of dimensionality” using simple examples based on simulation to show that all points are far away in high dimensions and that the mode is an atypical draw from a multivariate normal. The information-theoretic concept of typical set is illustrated with both discrete and continuous cases, which show that probability mass is a product of volume and density (or count and mass in the discrete case). It also illustrates Monte Carlo methods and relates distance to the log density of the normal distribution and the chi-squared distribution.</p>
<p><a href="case-studies/curse-dims.html">View R version</a> (HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Bob Carpenter
</dd>
<dt>Keywords</dt>
<dd>
probability mass, typical sets, concentration of measure, Monte Carlo methods
</dd>
<dt>Source Repository (R)</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/curse-dims" target="_blank">stan-dev/example-models/knitr/curse-dims</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>ggplot2</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
<p><a href="case-studies/curse-dims-python.html">View Python version</a> (HTML)</p>
<dl>
<dt>Author (Python translation)</dt>
<dd>
Aravind S (Python translation)
</dd>
<dt>Source Repository (Python)</dt>
<dd>
<a href="https://github.com/Arvinds-ds/Stan-Code/tree/master/python%20notebooks/curse_dims" target="_blank">Aravinds-ds/Stan-Code/python notebooks/curse_dims</a> (GitHub)
</dd>
<dt>Python Package Dependencies</dt>
<dd>
<code>numpy</code>, <code>scipy</code>, <code>pandas</code>, <code>matplotlib</code>, <code>collections</code>, <code>sys</code>
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="diagnosing-biased-inference-with-divergences" class="level3">
<h3 class="anchored" data-anchor-id="diagnosing-biased-inference-with-divergences">Diagnosing Biased Inference with Divergences</h3>
<p>This case study discusses the subtleties of accurate Markov chain Monte Carlo estimation and how divergences can be used to identify biased estimation in practice.</p>
<p><a href="case-studies/divergences_and_bias.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Michael Betancourt
</dd>
<dt>Keywords</dt>
<dd>
Markov chain Monte Carlo, Hamiltonian Monte Carlo, divergences, RStan
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/betanalpha/knitr_case_studies/tree/master/divergences_and_bias" target="_blank">betanalpha/knitr_case_studies/divergences_and_bias</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>knitr</code>.
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="identifying-bayesian-mixture-models" class="level3">
<h3 class="anchored" data-anchor-id="identifying-bayesian-mixture-models">Identifying Bayesian Mixture Models</h3>
<p>This case study discusses the common pathologies of Bayesian mixture models as well as some strategies for identifying and overcoming them.</p>
<p><a href="case-studies/identifying_mixture_models.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Michael Betancourt
</dd>
<dt>Keywords</dt>
<dd>
Markov chain Monte Carlo, Hamiltonian Monte Carlo, mixture models, multimodal models, RStan
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/betanalpha/knitr_case_studies/tree/master/identifying_mixture_models" target="_blank">betanalpha/knitr_case_studies/identifying_mixture_models</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>knitr</code>.
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
<section id="how-the-shape-of-a-weakly-informative-prior-affects-inferences" class="level3">
<h3 class="anchored" data-anchor-id="how-the-shape-of-a-weakly-informative-prior-affects-inferences">How the Shape of a Weakly Informative Prior Affects Inferences</h3>
<p>This case study reviews the basics of weakly-informative priors and how the choice of a specific shape of such a prior affects the resulting posterior distribution.</p>
<p><a href="case-studies/weakly_informative_shapes.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Michael Betancourt
</dd>
<dt>Keywords</dt>
<dd>
Markov chain Monte Carlo, Hamiltonian Monte Carlo, priors, weakly-informative priors, RStan
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/betanalpha/knitr_case_studies/tree/master/weakly_informative_shapes" target="_blank">betanalpha/knitr_case_studies/weakly_informative_shapes</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>knitr</code>.
</dd>
<dt>License</dt>
<dd>
Code: BSD (3 clause), Text: CC BY-NC 4.0
</dd>
</dl>
</section>
</section>
<section id="volume-3-2016" class="level2">
<h2 class="anchored" data-anchor-id="volume-3-2016">Volume 3 (2016)</h2>
<section id="exact-sparse-car-models-in-stan" class="level3">
<h3 class="anchored" data-anchor-id="exact-sparse-car-models-in-stan">Exact Sparse CAR Models in Stan</h3>
<p>This document details sparse exact conditional autoregressive (CAR) models in Stan as an extension of previous work on approximate sparse CAR models in Stan. Sparse representations seem to give order of magnitude efficiency gains, scaling better for large spatial data sets.</p>
<p><a href="case-studies/mbjoseph-CARStan.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Max Joseph
</dd>
<dt>Keywords</dt>
<dd>
conditional autoregressive (CAR), independent autoregressive (IAR), sparsity, spatial random effects, maps
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/mbjoseph/CARstan" target="_blank">mbjoseph/CARstan</a>(GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>dplyr</code>, <code>ggmcmc</code>, <code>knitr</code>, <code>maptools</code>, <code>rgeos</code>, <code>spdep</code>.
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="a-primer-on-bayesian-multilevel-modeling-using-pystan" class="level3">
<h3 class="anchored" data-anchor-id="a-primer-on-bayesian-multilevel-modeling-using-pystan">A Primer on Bayesian Multilevel Modeling using PyStan</h3>
<p>This case study replicates the analysis of home radon levels using hierarchical models of <a href="http://www.stat.columbia.edu/~gelman/research/published/lin.pdf" target="_blank">Lin, Gelman, Price, and Kurtz (1999)</a>. It illustrates how to generalize linear regressions to hierarchical models with group-level predictors and how to compare predictive inferences and evaluate model fits. Along the way it shows how to get data into Stan using pandas, how to sample using PyStan, and how to visualize the results using Seaborn.</p>
<p><a href="../learn-stan/case-studies/radon.ipynb" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Chris Fonnesbeck
</dd>
<dt>Keywords</dt>
<dd>
hierarchical/multilevel modeling, linear regression, model comparison, predictive inference, radon
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/fonnesbeck/stan_workshop_2016" target="_blank">fonnesbeck/stan_workshop_2016</a> (GitHub)
</dd>
<dt>Python Package Dependencies</dt>
<dd>
<code>pystan</code>, <code>numpy</code>, <code>pandas</code>, <code>matplotlib</code>, <code>seaborn</code>
</dd>
<dt>License</dt>
<dd>
Apache 2.0 (code), CC-BY 3 (text)
</dd>
</dl>
</section>
<section id="the-impact-of-reparameterization-on-point-estimates" class="level3">
<h3 class="anchored" data-anchor-id="the-impact-of-reparameterization-on-point-estimates">The Impact of Reparameterization on Point Estimates</h3>
<p>When changing variables, a Jacobian adjustment needs to be provided to account for the rate of change of the transform. Applying the adjustment ensures that inferences that are based on expectations over the posterior are invariant under reparameterizations. In contrast, the posterior mode changes as a result of the reparameterization. In this note, we use Stan to code a repeated binary trial model parameterized by chance of success, along with its reparameterization in terms of log odds in order to demonstrate the effect of the Jacobian adjustment on the Bayesian posterior and the posterior mode. We contrast the posterior mode to the maximum likelihood estimate, which, like the Bayesian estimates, is invariant under reparameterization. Along the way, we derive the logistic distribution by transforming a uniformly distributed variable.</p>
<p><a href="case-studies/mle-params.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Bob Carpenter
</dd>
<dt>Keywords</dt>
<dd>
MLE, Bayesian posterior, reparameterization, Jacobian, binomial
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/mle-params" target="_blank">example-models/knitr/mle-params</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="hierarchical-two-parameter-logistic-item-response-model" class="level3">
<h3 class="anchored" data-anchor-id="hierarchical-two-parameter-logistic-item-response-model">Hierarchical Two-Parameter Logistic Item Response Model</h3>
<p>This case study documents a Stan model for the two-parameter logistic model (2PL) with hierarchical priors. A brief simulation indicates that the Stan model successfully recovers the generating parameters. An example using a grade 12 science assessment is provided.</p>
<p><a href="case-studies/hierarchical_2pl.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Daniel C. Furr
</dd>
<dt>Keywords</dt>
<dd>
education, item response theory, two-parameter logistic model, hierarchical priors
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/hierarchical_2pl" target="_blank">example-models/education/hierarchical_2pl</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>ggplot2</code>, <code>mirt</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="rating-scale-and-generalized-rating-scale-models-with-latent-regression" class="level3">
<h3 class="anchored" data-anchor-id="rating-scale-and-generalized-rating-scale-models-with-latent-regression">Rating Scale and Generalized Rating Scale Models with Latent Regression</h3>
<p>This case study documents a Stan model for the rating scale model (RSM) and the generalized rating scale model (GRSM) with latent regression. The latent regression portion of the models may be restricted to an intercept only, yielding a standard RSM or GRSM. A brief simulation indicates that the Stan models successfully recover the generating parameters. An example using a survey of public perceptions of science and technology is provided.</p>
<p><a href="case-studies/rsm_and_grsm.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Daniel C. Furr
</dd>
<dt>Keywords</dt>
<dd>
education, item response theory, rating scale model, generalized rating scale model
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/rsm_and_grsm" target="_blank">example-models/education/rsm_and_grsm</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>edstan</code>, <code>ggplot2</code>, <code>ltm</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="partial-credit-and-generalized-partial-credit-models-with-latent-regression" class="level3">
<h3 class="anchored" data-anchor-id="partial-credit-and-generalized-partial-credit-models-with-latent-regression">Partial Credit and Generalized Partial Credit Models with Latent Regression</h3>
<p>This case study documents a Stan model for the partial credit model (PCM) and the generalized partial credit model (GPCM) with latent regression. The latent regression portion of the models may be restricted to an intercept only, yielding a standard PCM or GPCM. A brief simulation indicates that the Stan models successfully recover the generating parameters. An example using the TIMSS 2011 mathematics assessment is provided</p>
<p><a href="case-studies/pcm_and_gpcm.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Daniel C. Furr
</dd>
<dt>Keywords</dt>
<dd>
education, item response theory, partial credit model, generalized partial credit model
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/pcm_and_gpcm" target="_blank">example-models/education/pcm_and_gpcm</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>edstan</code>, <code>ggplot2</code>, <code>TAM</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="rasch-and-two-parameter-logistic-item-response-models-with-latent-regression" class="level3">
<h3 class="anchored" data-anchor-id="rasch-and-two-parameter-logistic-item-response-models-with-latent-regression">Rasch and Two-Parameter Logistic Item Response Models with Latent Regression</h3>
<p>This case study documents Stan models for the Rasch and two-parameter logistic models with latent regression. The latent regression portion of the models may be restricted to an intercept only, yielding standard versions of the models. Simulations indicate that the two models successfully recover generating parameters. An example using a grade 12 science assessment is provided.</p>
<p><a href="case-studies/rasch_and_2pl.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Authors</dt>
<dd>
Daniel C. Furr
</dd>
<dt>Keywords</dt>
<dd>
education, item response theory, rasch model, two-parameter logistic model
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/rasch_and_2pl" target="_blank">example-models/education/rasch_and_2pl.html</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>edstan</code>, <code>ggplot2</code>, <code>TAM</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="two-parameter-logistic-item-response-model" class="level3">
<h3 class="anchored" data-anchor-id="two-parameter-logistic-item-response-model">Two-Parameter Logistic Item Response Model</h3>
<p>This tutorial introduces the R package edstan for estimating two-parameter logistic item response models using Stan without knowing the Stan language. Subsequently, the tutorial explains how the model can be expressed in the Stan language and fit using the rstan package. Specification of prior distributions and assessment of convergence are discussed. Using the Stan language directly has the advantage that it becomes quite easy to extend the model, and this is demonstrated by adding a latent regression and differential item functioning to the model. Posterior predictive model checking is also demonstrated.</p>
<p><a href="case-studies/tutorial_twopl.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Daniel C. Furr, Seung Yeon Lee, Joon-Ho Lee, and Sophia Rabe-Hesketh
</dd>
<dt>Keywords</dt>
<dd>
education, item response theory, two-parameter logistic model
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/tutorial_twopl" target="_blank">example-models/education/tutorial_twopl</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>reshape2</code>, <code>ggplot2</code>, <code>gridExtra</code>, <code>devtools</code>, <code>edstan</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="cognitive-diagnosis-model-dina-model-with-independent-attributes" class="level3">
<h3 class="anchored" data-anchor-id="cognitive-diagnosis-model-dina-model-with-independent-attributes">Cognitive Diagnosis Model: DINA model with independent attributes</h3>
<p>This case study documents a Stan model for the DINA model with independent attributes. A Simulation indicates that the Stan model successfully recovers the generating parameters and predicts respondents’ attribute mastery. A Stan model with no structure of the attributes is also discussed and applied to the simulated data. An example using a subset of the fraction subtraction data is provided.</p>
<p><a href="case-studies/dina_independent.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Seung Yeon Lee
</dd>
<dt>Keywords</dt>
<dd>
education, cognitive diagnosis model, diagnostic classification model, attribute mastery, DINA
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/education/dina_independent" target="_blank">example-models/education/dina_independent</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>ggplot2</code>, <code>CDM</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
</section>
<section id="pooling-with-hierarchical-models-for-repeated-binary-trials" class="level3">
<h3 class="anchored" data-anchor-id="pooling-with-hierarchical-models-for-repeated-binary-trials">Pooling with Hierarchical Models for Repeated Binary Trials</h3>
<p>This note illustrates the effects on posterior inference of pooling data (aka sharing strength) across items for repeated binary trial data. It provides Stan models and R code to fit and check predictive models for three situations: (a) complete pooling, which assumes each item is the same, (b) no pooling, which assumes the items are unrelated, and (c) partial pooling, where the similarity among the items is estimated. We consider two hierarchical models to estimate the partial pooling, one with a beta prior on chance of success and another with a normal prior on the log odds of success. The note explains with working examples how to (i) fit models in RStan and plot the results in R using ggplot2, (ii) estimate event probabilities, (iii) evaluate posterior predictive densities to evaluate model predictions on held-out data, (iv) rank items by chance of success, (v) perform multiple comparisons in several settings, (vi) replicate new data for posterior p-values, and (vii) perform graphical posterior predictive checks.</p>
<p><a href="case-studies/pool-binary-trials.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Bob Carpenter
</dd>
<dt>Keywords</dt>
<dd>
binary trials, pooling, hierarchical models, baseball, epidemiology, prediction, posterior predictive checks
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/pool-binary-trials" target="_blank">example-models/knitr/pool-binary-trials</a> (GitHub)
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>ggplot2</code>, <code>rmarkdown</code>
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
</dl>
<section id="rstanarm-version" class="level5">
<h5 class="anchored" data-anchor-id="rstanarm-version">RStanARM version</h5>
<p>There is also a version of this case study in which all models are fit using the RStanARM interface. Many of the visualizations are also created using RStanARM’s plotting functions.</p>
<p><a href="case-studies/pool-binary-trials-rstanarm.html" target="_blank">View RStanARM version</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Bob Carpenter, Jonah Gabry, Ben Goodrich
</dd>
</dl>
</section>
</section>
</section>
<section id="volume-2-2015" class="level2">
<h2 class="anchored" data-anchor-id="volume-2-2015">Volume 2 (2015)</h2>
<section id="multiple-species-site-occupancy-model" class="level3">
<h3 class="anchored" data-anchor-id="multiple-species-site-occupancy-model">Multiple Species-Site Occupancy Model</h3>
<p>This case study replicates the analysis and output graphs of Dorazio et al.&nbsp;(2006) noisy-measurement occupancy model for multiple species abundance of butterflies. Going beyond the paper, the supercommunity assumptions are tested to show they are invariant to sizing, and posterior predictive checks are provided.</p>
<p><a href="case-studies/dorazio-royle-occupancy.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Bob Carpenter
</dd>
<dt>Keywords</dt>
<dd>
ecology, occupancy, species abundance, supercommunity, posterior predictive check
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/stan-dev/example-models/tree/master/knitr/dorazio-royle-occupancy" target="_blank">example-models/knitr/dorazio-royle-occupancy</a> (GitHub)
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>ggplot2</code>, <code>rmarkdown</code>
</dd>
</dl>
</section>
</section>
<section id="volume-1-2014" class="level2">
<h2 class="anchored" data-anchor-id="volume-1-2014">Volume 1 (2014)</h2>
<section id="soil-carbon-modeling-with-rstan" class="level3">
<h3 class="anchored" data-anchor-id="soil-carbon-modeling-with-rstan">Soil Carbon Modeling with RStan</h3>
<p>This case study provides ordinary differential equation-based compartment models of soil carbon flux, with experimental data fitted with unknown initial compartment balance and noisy CO<sub>2</sub> measurements. Results form Sierra and Müller’s (2014) soilR package are replicated.</p>
<p><a href="case-studies/soil-knit.html" target="_blank">View</a>(HTML)</p>
<dl>
<dt>Author</dt>
<dd>
Bob Carpenter
</dd>
<dt>Keywords</dt>
<dd>
biogeochemistry, compartment ODE, soil carbon respiration, incubation experiment
</dd>
<dt>Source Repository</dt>
<dd>
<a href="https://github.com/soil-metamodel/stan/tree/master/soil-incubation" target="_blank">soil-metamodel/stan/soil-knit</a> (GitHub)
</dd>
<dt>License</dt>
<dd>
BSD (3 clause), CC-BY
</dd>
<dt>R Package Dependencies</dt>
<dd>
<code>rstan</code>, <code>ggplot2</code>, <code>rmarkdown</code>
</dd>
</dl>
</section>
</section>
<section id="contributing-case-studies" class="level2">
<h2 class="anchored" data-anchor-id="contributing-case-studies">Contributing Case Studies</h2>
<p>To contribute a case study, please contact us through the <a href="https://discourse.mc-stan.org/" target="_blank">Stan Forums</a>. We require</p>
<ul>
<li><p>a documented, reproducible example with narrative documentation (e.g., knitr or Jupyter with software/compiler versions noted and seeds fixed) and</p></li>
<li><p>an open-source code license (preferably BSD or GPL for code, Creative Commons for text); authors retain all copyright.</p></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>